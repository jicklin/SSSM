function TCRSReportState(g,f,h,e){this.crsDataSet=g;this.i_repid=f;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_reportstate","workflow, organidlist, useridlist, writetimelist, finishtimelist, dataflow, prevtask, prevwriter","repid='"+f+"' and userid='"+h+"' and writetime='"+e+"'","id")}TCRSReportState.prototype=new TCRSDataRecord();TCRSReportState.prototype.get_prev_writer=function(e){this.loadData("#tablecrs_reportstate");var d="";var f=this.search("workflow",e);if(f!=null){d=f.prevwriter}return d};TCRSReportState.prototype.get_task_state=function(p,i){this.loadData("#tablecrs_reportstate");var o="done";var l=this.search("workflow",p);if(l!=null){if(l.useridlist!=""){var k=HandleMemoStr(l.useridlist,false).split(",");var n=HandleMemoStr(l.finishtimelist,false).split(",");if(k.length>n.length){o=""}else{for(var m=0,j=k.length;m<j;m++){if(i!=""&&k[m]==i){continue}if(n[m]==""){o="";break}}}}}else{o="unknown"}return o};TCRSReportState.prototype.get_writer_list=function(d){var e=null;var f=this.search("workflow",d);if(f!=null){e={};e.arr_organid=HandleMemoStr(f.organidlist,false).split(",");e.arr_userid=HandleMemoStr(f.useridlist,false).split(",");e.arr_finishtime=HandleMemoStr(f.finishtimelist,false).split(",")}return e};TCRSReportState.prototype.get_done_task=function(){if(!this.doLoaded&&!crsReport.has_workflow()){this.doLoaded=true}this.loadData("#tablecrs_reportstate");var i=[];if(!this.isEmpty()){var j=this.first();while(!this.EOF()){var l=j.workflow;l=crsReport.crsWorkflow.get_valid_task(l);if(l==crsReport.s_begin_task){l=""}if(i.indexOf(l)==-1){var k=j.useridlist.split(",");var o=j.finishtimelist.split(",");var n=k.length_without_null,p=o.length_without_null;if(l==""){if(crsReport.s_write_mode=="y"){if(n<=p){i.push(l)}}else{if(p>0){i.push(l)}}}else{var m=crsReport.crsWorkflow.get_schedule(l);if(m!="\u62a2\u5148\u5f0f"){if(n<=p){i.push(l)}}else{if(p>0){i.push(l)}}}}j=this.next()}}return(i.length_without_null()<=0)?null:i};TCRSReportState.prototype.get_data_flow=function(c){this.loadData("#tablecrs_reportstate");var d=this.search("workflow",c);if(d!=null){return HandleMemoStr(d.dataflow,false).replaceAll("&gt;",">")}return""};TCRSReportState.prototype.get_prev_tasks=function(c,a){this.loadData("#tablecrs_reportstate");if(a==undefined){a=""}if(a==""){a=crsReport.s_cur_task}var b=this.search("workflow",a);if(b!=null){if(b.prevtask==""&&b.workflow!=""){$(c).append("<li onclick='rollback_report(this)'>"+crsReport.s_begin_task+"<\u521d\u59cb\u586b\u62a5></li>")}else{$(c).append("<li onclick='rollback_report(this)'>"+b.prevtask+"</li>");this.get_prev_tasks(c,b.prevtask)}}};TCRSReportState.prototype.get_write_list=function(d){var e="";var c={};var b=this.search("workflow",d);if(b!=null){c.u=b.useridlist.split(",");c.t=b.finishtimelist.split(",");for(var f=0,a=c.t.length;f<a;f++){if(c.t[f]!=""){e+=c.u[f]+","}}}return e};
